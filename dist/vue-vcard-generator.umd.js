(function(o,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue"),require("qrcode")):typeof define=="function"&&define.amd?define(["exports","vue","qrcode"],n):(o=typeof globalThis<"u"?globalThis:o||self,n(o.VueVCardGenerator={},o.Vue,o.QRCode))})(this,function(o,n,m){"use strict";const u={class:"vcard-generator"},p={key:0,class:"vcard-qr"},C=["src"],w={class:"vcard-actions"},l={__name:"VCardGenerator",props:{contact:{type:Object,required:!0,validator:function(a){return a.name&&(a.email||a.phone)}},showQR:{type:Boolean,default:!0},showNFC:{type:Boolean,default:!1},showDownload:{type:Boolean,default:!1}},emits:["vcard-generated","vcard-downloaded","nfc-scanning","nfc-success","nfc-error","qr-error"],setup(a,{emit:N}){const t=a,c=N,d=n.ref(""),i=n.ref(null),s=n.ref(!1),f=()=>{let e=`BEGIN:VCARD
VERSION:3.0
`;e+=`FN:${t.contact.name}
`,t.contact.firstName&&t.contact.lastName&&(e+=`N:${t.contact.lastName};${t.contact.firstName};;;
`),t.contact.organization&&(e+=`ORG:${t.contact.organization}
`),t.contact.title&&(e+=`TITLE:${t.contact.title}
`),t.contact.phone&&(e+=`TEL;TYPE=CELL:${t.contact.phone}
`),t.contact.email&&(e+=`EMAIL:${t.contact.email}
`),t.contact.website&&(e+=`URL:${t.contact.website}
`),t.contact.address&&(e+=`ADR:;;${t.contact.address};;;;
`),t.contact.linkedin&&(e+=`URL;TYPE=LINKEDIN:${t.contact.linkedin}
`),t.contact.twitter&&(e+=`URL;TYPE=TWITTER:${t.contact.twitter}
`),e+="END:VCARD",d.value=e,t.showQR&&E(),c("vcard-generated",{vcardString:e,dataUrl:`data:text/vcard;charset=utf-8,${encodeURIComponent(e)}`})},E=async()=>{try{i.value=await m.toDataURL(d.value,{errorCorrectionLevel:"H",margin:1,width:200})}catch(e){console.error("Error al generar QR:",e),c("qr-error",e.message)}},y=()=>{const e=`data:text/vcard;charset=utf-8,${encodeURIComponent(d.value)}`,r=document.createElement("a");r.href=e,r.download=`${t.contact.name.replace(/\s+/g,"_")}.vcf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),c("vcard-downloaded")},v=()=>{s.value=typeof window<"u"&&"NDEFReader"in window},R=async()=>{if(!s.value){c("nfc-error","NFC no es compatible con este dispositivo");return}try{const e=new window.NDEFReader;await e.scan(),c("nfc-scanning"),e.onreading=async()=>{try{await e.write({records:[{recordType:"mime",mediaType:"text/vcard",data:new TextEncoder().encode(d.value)}]}),c("nfc-success","vCard escrita correctamente a la etiqueta NFC")}catch(r){c("nfc-error",r.message)}}}catch(e){c("nfc-error",e.message)}};return n.watch(()=>t.contact,()=>{f()},{deep:!0}),n.onMounted(()=>{f(),v()}),(e,r)=>(n.openBlock(),n.createElementBlock("div",u,[i.value?(n.openBlock(),n.createElementBlock("div",p,[n.createElementVNode("img",{src:i.value,alt:"QR Code"},null,8,C)])):n.createCommentVNode("",!0),n.createElementVNode("div",w,[a.showDownload?(n.openBlock(),n.createElementBlock("button",{key:0,onClick:y,class:"vcard-btn"}," Descargar vCard ")):n.createCommentVNode("",!0),s.value&&a.showNFC?(n.openBlock(),n.createElementBlock("button",{key:1,onClick:R,class:"vcard-btn"}," Escribir a NFC ")):n.createCommentVNode("",!0)])]))}},h={install(a){a.component("VCardGenerator",l)}};o.VCardGenerator=l,o.default=h,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
