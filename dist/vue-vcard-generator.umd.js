(function(r,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("qrcode")):typeof define=="function"&&define.amd?define(["exports","vue","qrcode"],t):(r=typeof globalThis<"u"?globalThis:r||self,t(r.VueVCardGenerator={},r.Vue,r.QRCode))})(this,function(r,t,w){"use strict";const C={class:"vcard-generator"},E={key:0,class:"vcard-photo"},N=["src"],g={key:1,class:"vcard-qr"},v=["src"],y={class:"vcard-actions"},p={__name:"VCardGenerator",props:{contact:{type:Object,required:!0,validator:function(c){return c.name&&(c.email||c.phone)}},photo:{type:String,default:null},showQR:{type:Boolean,default:!0},showNFC:{type:Boolean,default:!1},showDownload:{type:Boolean,default:!1}},emits:["vcard-generated","vcard-downloaded","nfc-scanning","nfc-success","nfc-error","qr-error","photo-error"],setup(c,{emit:k}){const o=c,n=k,d=t.ref(""),f=t.ref(null),u=t.ref(!1),l=t.ref(null),s=t.ref(null),h=async()=>{if(!o.photo){l.value=null,s.value=null;return}try{l.value=o.photo;const a=await(await fetch(o.photo)).blob(),i=new FileReader;i.onload=()=>{s.value=i.result.split(",")[1],m()},i.onerror=$=>{n("photo-error","Error al procesar la imagen de URL: "+$),s.value=null},i.readAsDataURL(a)}catch(e){n("photo-error","Error al procesar la imagen: "+e.message),l.value=null,s.value=null}},m=()=>{let e=`BEGIN:VCARD
VERSION:3.0
`;if(e+=`FN:${o.contact.name}
`,o.contact.firstName&&o.contact.lastName&&(e+=`N:${o.contact.lastName};${o.contact.firstName};;;
`),o.contact.organization&&(e+=`ORG:${o.contact.organization}
`),o.contact.title&&(e+=`TITLE:${o.contact.title}
`),o.contact.phone&&(e+=`TEL;TYPE=CELL:${o.contact.phone}
`),o.contact.email&&(e+=`EMAIL:${o.contact.email}
`),o.contact.website&&(e+=`URL:${o.contact.website}
`),o.contact.address&&(e+=`ADR:;;${o.contact.address};;;;
`),o.contact.linkedin&&(e+=`URL;TYPE=LINKEDIN:${o.contact.linkedin}
`),o.contact.twitter&&(e+=`URL;TYPE=TWITTER:${o.contact.twitter}
`),s.value){let a="JPEG";l.value.includes("data:image/png")?a="PNG":l.value.includes("data:image/gif")&&(a="GIF"),e+=`PHOTO;ENCODING=b;TYPE=${a}:${s.value}
`}e+="END:VCARD",d.value=e,o.showQR&&V(),n("vcard-generated",{vcardString:e,dataUrl:`data:text/vcard;charset=utf-8,${encodeURIComponent(e)}`})},V=async()=>{try{f.value=await w.toDataURL(d.value,{errorCorrectionLevel:"H",margin:1,width:200})}catch(e){console.error("Error al generar QR:",e),n("qr-error",e.message)}},b=()=>{const e=`data:text/vcard;charset=utf-8,${encodeURIComponent(d.value)}`,a=document.createElement("a");a.href=e,a.download=`${o.contact.name.replace(/\s+/g,"_")}.vcf`,document.body.appendChild(a),a.click(),document.body.removeChild(a),n("vcard-downloaded")},T=()=>{u.value=typeof window<"u"&&"NDEFReader"in window},_=async()=>{if(!u.value){n("nfc-error","NFC no es compatible con este dispositivo");return}try{const e=new window.NDEFReader;await e.scan(),n("nfc-scanning"),e.onreading=async()=>{try{await e.write({records:[{recordType:"text",data:d.value}]}),n("nfc-success","vCard escrita correctamente a la etiqueta NFC")}catch(a){n("nfc-error",a.message)}}}catch(e){n("nfc-error",e.message)}};return t.watch(()=>o.contact,()=>{m()},{deep:!0}),t.watch(()=>o.photo,()=>{h()}),t.onMounted(()=>{h(),m(),T()}),(e,a)=>(t.openBlock(),t.createElementBlock("div",C,[l.value?(t.openBlock(),t.createElementBlock("div",E,[t.createElementVNode("img",{src:l.value,alt:"Foto de perfil"},null,8,N)])):t.createCommentVNode("",!0),f.value?(t.openBlock(),t.createElementBlock("div",g,[t.createElementVNode("img",{src:f.value,alt:"QR Code"},null,8,v)])):t.createCommentVNode("",!0),t.createElementVNode("div",y,[c.showDownload?(t.openBlock(),t.createElementBlock("button",{key:0,onClick:b,class:"vcard-btn"}," Descargar vCard ")):t.createCommentVNode("",!0),u.value&&c.showNFC?(t.openBlock(),t.createElementBlock("button",{key:1,onClick:_,class:"vcard-btn"}," Escribir a NFC ")):t.createCommentVNode("",!0)])]))}},R={install(c){c.component("VCardGenerator",p)}};r.VCardGenerator=p,r.default=R,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
