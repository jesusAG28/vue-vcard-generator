(function(r,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue"),require("qrcode")):typeof define=="function"&&define.amd?define(["exports","vue","qrcode"],o):(r=typeof globalThis<"u"?globalThis:r||self,o(r.VueVCardGenerator={},r.Vue,r.QRCode))})(this,function(r,o,C){"use strict";const w={class:"vcard-generator"},v={key:0,class:"vcard-photo"},E=["src"],N={key:1,class:"vcard-qr"},g=["src"],y={class:"vcard-actions"},m={__name:"VCardGenerator",props:{contact:{type:Object,required:!0,validator:function(c){return c.name&&(c.email||c.phone)}},photo:{type:String,default:null},showQR:{type:Boolean,default:!0},showNFC:{type:Boolean,default:!1}},emits:["vcard-generated","vcard-downloaded","nfc-scanning","nfc-success","nfc-error","qr-error","photo-error"],setup(c,{emit:_}){const t=c,n=_,d=o.ref(""),u=o.ref(null),f=o.ref(!1),s=o.ref(null),l=o.ref(null),h=async()=>{if(!t.photo){s.value=null,l.value=null;return}try{s.value=t.photo;const a=await(await fetch(t.photo)).blob(),i=new FileReader;i.onload=()=>{l.value=i.result.split(",")[1],p()},i.onerror=$=>{n("photo-error","Error al procesar la imagen de URL: "+$),l.value=null},i.readAsDataURL(a)}catch(e){n("photo-error","Error al procesar la imagen: "+e.message),s.value=null,l.value=null}},p=()=>{let e=`BEGIN:VCARD
VERSION:3.0
`;if(e+=`FN:${t.contact.name}
`,t.contact.firstName&&t.contact.lastName&&(e+=`N:${t.contact.lastName};${t.contact.firstName};;;
`),t.contact.organization&&(e+=`ORG:${t.contact.organization}
`),t.contact.title&&(e+=`TITLE:${t.contact.title}
`),t.contact.phone&&(e+=`TEL;TYPE=CELL:${t.contact.phone}
`),t.contact.email&&(e+=`EMAIL:${t.contact.email}
`),t.contact.website&&(e+=`URL:${t.contact.website}
`),t.contact.address&&(e+=`ADR:;;${t.contact.address};;;;
`),t.contact.linkedin&&(e+=`URL;TYPE=LINKEDIN:${t.contact.linkedin}
`),t.contact.twitter&&(e+=`URL;TYPE=TWITTER:${t.contact.twitter}
`),l.value){let a="JPEG";s.value.includes("data:image/png")?a="PNG":s.value.includes("data:image/gif")&&(a="GIF"),e+=`PHOTO;ENCODING=b;TYPE=${a}:${l.value}
`}e+="END:VCARD",d.value=e,t.showQR&&k(),n("vcard-generated",{vcardString:e,dataUrl:`data:text/vcard;charset=utf-8,${encodeURIComponent(e)}`})},k=async()=>{try{u.value=await C.toDataURL(d.value,{errorCorrectionLevel:"H",margin:1,width:200})}catch(e){console.error("Error al generar QR:",e),n("qr-error",e.message)}},V=()=>{const e=`data:text/vcard;charset=utf-8,${encodeURIComponent(d.value)}`,a=document.createElement("a");a.href=e,a.download=`${t.contact.name.replace(/\s+/g,"_")}.vcf`,document.body.appendChild(a),a.click(),document.body.removeChild(a),n("vcard-downloaded")},b=()=>{f.value=typeof window<"u"&&"NDEFReader"in window},T=async()=>{if(!f.value){n("nfc-error","NFC no es compatible con este dispositivo");return}try{const e=new window.NDEFReader;await e.scan(),n("nfc-scanning"),e.onreading=async()=>{try{await e.write({records:[{recordType:"text",data:d.value}]}),n("nfc-success","vCard escrita correctamente a la etiqueta NFC")}catch(a){n("nfc-error",a.message)}}}catch(e){n("nfc-error",e.message)}};return o.watch(()=>t.contact,()=>{p()},{deep:!0}),o.watch(()=>t.photo,()=>{h()}),o.onMounted(()=>{h(),p(),b()}),(e,a)=>(o.openBlock(),o.createElementBlock("div",w,[s.value?(o.openBlock(),o.createElementBlock("div",v,[o.createElementVNode("img",{src:s.value,alt:"Foto de perfil"},null,8,E)])):o.createCommentVNode("",!0),u.value?(o.openBlock(),o.createElementBlock("div",N,[o.createElementVNode("img",{src:u.value,alt:"QR Code"},null,8,g)])):o.createCommentVNode("",!0),o.createElementVNode("div",y,[o.createElementVNode("button",{onClick:V,class:"vcard-btn"},"Descargar vCard"),f.value&&c.showNFC?(o.openBlock(),o.createElementBlock("button",{key:0,onClick:T,class:"vcard-btn"}," Escribir a NFC ")):o.createCommentVNode("",!0)])]))}},R={install(c){c.component("VCardGenerator",m)}};r.VCardGenerator=m,r.default=R,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
