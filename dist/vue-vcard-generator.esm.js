import e from"qrcode";var t={name:"VCardGenerator",props:{contact:{type:Object,required:!0,validator:function(e){return e.name&&(e.email||e.phone)}},showQR:{type:Boolean,default:!0}},emits:["vcard-generated","vcard-downloaded","nfc-scanning","nfc-success","nfc-error","qr-error"],data:()=>({vcardData:"",qrCode:null,nfcSupported:!1}),mounted(){this.generateVCard(),this.checkNFCSupport()},watch:{contact:{handler(){this.generateVCard()},deep:!0}},methods:{generateVCard(){let e="BEGIN:VCARD\nVERSION:3.0\n";e+=`FN:${this.contact.name}\n`,this.contact.firstName&&this.contact.lastName&&(e+=`N:${this.contact.lastName};${this.contact.firstName};;;\n`),this.contact.organization&&(e+=`ORG:${this.contact.organization}\n`),this.contact.title&&(e+=`TITLE:${this.contact.title}\n`),this.contact.phone&&(e+=`TEL;TYPE=CELL:${this.contact.phone}\n`),this.contact.email&&(e+=`EMAIL:${this.contact.email}\n`),this.contact.website&&(e+=`URL:${this.contact.website}\n`),this.contact.address&&(e+=`ADR:;;${this.contact.address};;;;\n`),this.contact.linkedin&&(e+=`URL;TYPE=LINKEDIN:${this.contact.linkedin}\n`),this.contact.twitter&&(e+=`URL;TYPE=TWITTER:${this.contact.twitter}\n`),e+="END:VCARD",this.vcardData=e,this.showQR&&this.generateQRCode(),this.$emit("vcard-generated",{vcardString:e,dataUrl:`data:text/vcard;charset=utf-8,${encodeURIComponent(e)}`})},async generateQRCode(){try{this.qrCode=await e.toDataURL(this.vcardData,{errorCorrectionLevel:"H",margin:1,width:200})}catch(e){console.error("Error al generar QR:",e),this.$emit("qr-error",e.message)}},downloadVCard(){const e=`data:text/vcard;charset=utf-8,${encodeURIComponent(this.vcardData)}`,t=document.createElement("a");t.href=e,t.download=`${this.contact.name.replace(/\s+/g,"_")}.vcf`,document.body.appendChild(t),t.click(),document.body.removeChild(t),this.$emit("vcard-downloaded")},checkNFCSupport(){this.nfcSupported="undefined"!=typeof window&&"NDEFReader"in window},async writeToNFC(){if(this.nfcSupported)try{const e=new window.NDEFReader;await e.scan(),this.$emit("nfc-scanning"),e.onreading=async()=>{try{await e.write({records:[{recordType:"text",data:this.vcardData}]}),this.$emit("nfc-success","vCard escrita correctamente a la etiqueta NFC")}catch(e){this.$emit("nfc-error",e.message)}}}catch(e){this.$emit("nfc-error",e.message)}else this.$emit("nfc-error","NFC no es compatible con este dispositivo")}}};function n(e,t,n,a,r,o,i,c,s,d){"boolean"!=typeof i&&(s=c,c=i,i=!1);const l="function"==typeof n?n.options:n;let h;if(e&&e.render&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,r&&(l.functional=!0)),a&&(l._scopeId=a),o?(h=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,s(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},l._ssrRegister=h):t&&(h=i?function(e){t.call(this,d(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,c(e))}),h)if(l.functional){const e=l.render;l.render=function(t,n){return h.call(n),e(t,n)}}else{const e=l.beforeCreate;l.beforeCreate=e?[].concat(e,h):[h]}return n}const a="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function r(e){return(e,t)=>function(e,t){const n=a?t.media||"default":e,r=i[n]||(i[n]={ids:new Set,styles:[]});if(!r.ids.has(e)){r.ids.add(e);let n=t.source;if(t.map&&(n+="\n/*# sourceURL="+t.map.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),r.element||(r.element=document.createElement("style"),r.element.type="text/css",t.media&&r.element.setAttribute("media",t.media),void 0===o&&(o=document.head||document.getElementsByTagName("head")[0]),o.appendChild(r.element)),"styleSheet"in r.element)r.styles.push(n),r.element.styleSheet.cssText=r.styles.filter(Boolean).join("\n");else{const e=r.ids.size-1,t=document.createTextNode(n),a=r.element.childNodes;a[e]&&r.element.removeChild(a[e]),a.length?r.element.insertBefore(t,a[e]):r.element.appendChild(t)}}}(e,t)}let o;const i={};const c=n({render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"vcard-generator"},[e.qrCode?n("div",{staticClass:"vcard-qr"},[n("img",{attrs:{src:e.qrCode,alt:"QR Code"}})]):e._e(),n("div",{staticClass:"vcard-actions"},[n("button",{staticClass:"vcard-btn",on:{click:e.downloadVCard}},[e._v("Descargar vCard")]),e.nfcSupported?n("button",{staticClass:"vcard-btn",on:{click:e.writeToNFC}},[e._v(" Escribir a NFC ")]):e._e()])])},staticRenderFns:[]},(function(e){e&&e("data-v-0a004f03_0",{source:".vcard-generator{display:flex;flex-direction:column;align-items:center;width:100%;max-width:300px;margin:0 auto}.vcard-qr{margin-bottom:1rem;border:1px solid #ddd;padding:.5rem;border-radius:4px}.vcard-qr img{display:block;max-width:100%;height:auto}.vcard-actions{display:flex;gap:.5rem;width:100%}.vcard-btn{flex:1;padding:.5rem 1rem;background-color:#4285f4;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:.875rem;transition:background-color .2s}.vcard-btn:hover{background-color:#3367d6}",map:void 0,media:void 0})}),t,undefined,false,undefined,!1,r,void 0,void 0);var s={install:function(e){e.component("VCardGenerator",c)}};export{c as VCardGenerator,s as default};
